<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Protected Page</title>
  <style>
    body { font-family: system-ui, Arial; max-width: 720px; margin: 24px auto; padding: 16px; background:#f7f7fb; color:#111; }
    .ok { color:#15803d; font-weight:700; }
    .warn { color:#b45309; font-weight:700; }
    .err { color:#b91c1c; font-weight:700; }
    .card { border:1px solid #e5e7eb; border-radius:10px; padding:12px; background:white; }
    button { padding:10px 14px; border-radius:10px; border:1px solid #d1d5db; background:white; cursor:pointer; font-weight:600; }
  </style>
</head>
<body
  data-supabase-url="https://dtmqecmuynheejxnyrfn.supabase.co"
  data-supabase-anon-key="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImR0bXFlY211eW5oZWVqeG55cmZuIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjEyNDk3NzksImV4cCI6MjA3NjgyNTc3OX0.E06vwUuYIJqGQlw3ZazaG3W8lfoqaCeEVf_KeUhg0oQ"
>
  <h1>Protected Page</h1>
  <div id="status" class="card">Loading...</div>
  <p><a href="./index.html">Back to home</a></p>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script>
    const body = document.body;
    const SUPABASE_URL = body.dataset.supabaseUrl;
    const SUPABASE_ANON_KEY = body.dataset.supabaseAnonKey;
    const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    async function main() {
      const { data: { session } } = await supabase.auth.getSession();
      const box = document.getElementById('status');

      if (!session) {
        box.className = 'card err';
        box.innerHTML = 'No session. Please <a href="./index.html">log in</a>.';
        return;
      }

      const user = session.user;
      if (!user.email_confirmed_at) {
        box.className = 'card warn';
        box.innerHTML = 'You are signed in but your email is not verified. Open the link we sent you, then refresh this page.';
        return;
      }

      box.className = 'card ok';
      box.innerHTML = `Welcome, ${user.email}. Your email is verified. This is your gated content.`;
    }

    main();
  </script>
</body>
</html>